<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EMI AutoPay ‚Äì Receiver Panel</title>

    <link rel="stylesheet" href="style.css" />

    <!-- Ethers (EVM only ‚Äì receiver side) -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tronweb/dist/TronWeb.js"></script>

    <!-- Receiver Logic -->
    <script type="module" src="./receiver.js" defer></script>
</head>

<body>

    <!-- ================= HEADER ================= -->
    <header class="header">
        <button class="back-btn" onclick="goBack()">‚Üê Back</button>
        <h1>Receiver Dashboard</h1>
        <p class="subtitle">Create & manage EMI auto-payment plans</p>
    </header>

    <!-- ================= WALLET ================= -->
    <section id="walletSection" class="card">
        <h2>Receiver Wallet</h2>

        <button id="connectWalletBtn">Connect Wallet</button>
        <button id="disconnectWalletBtn" style="display:none;">Disconnect</button>

        <p id="account" class="muted"></p>
        <p id="network" class="muted"></p>

        <p class="info">
            üîê Only the receiver connects here.<br />
            üë§ Sender never connects to this application.
        </p>
    </section>

    <!-- ================= CREATE EMI ================= -->
    <section id="createPlan" class="card">
        <h2>Create EMI Plan</h2>

        <!-- Blockchain -->
        <label>Blockchain</label>
        <select id="blockchainSelect"></select>

        <!-- Token -->
        <label>Token</label>
        <select id="tokenSelect"></select>

        <label>Token Address</label>
        <input id="tokenAddressDisplay" type="text" disabled />

        <!-- EMI -->
        <label>EMI Amount</label>
        <input id="emiAmount" type="number" placeholder="e.g. 100" />

        <!-- Interval -->
        <label>Payment Interval</label>
        <select id="intervalSelect">
            <option value="3600">1 Hour</option>
            <option value="10800">3 Hours</option>
            <option value="21600">6 Hours</option>
            <option value="43200">12 Hours</option>
            <option value="86400">Daily</option>
            <option value="604800">Weekly</option>
            <option value="2592000">Monthly</option>
            <option value="custom">Custom (minutes)</option>
        </select>

        <input id="customInterval" type="number" placeholder="Minutes" style="display:none;" />

        <!-- Total -->
        <label>Total Amount</label>
        <input id="totalAmount" type="number" placeholder="e.g. 1200" />

        <button id="createPlanBtn" class="primary-btn">
            Create EMI Plan
        </button>

        <div class="info-box">
            <h4>What happens next?</h4>
            <ol>
                <li>Share the <b>Plan ID</b> with sender</li>
                <li>Sender optionally sends down-payment</li>
                <li>Sender approves & activates EMI (one time)</li>
                <li>Auto-payments start</li>
            </ol>
        </div>
    </section>

    <!-- ================= MODIFY RECEIVER ================= -->
    <section id="modifyReceiverSection" class="card warning">
        <h2>Modify Receiver Address</h2>

        <input id="modifyPlanId" type="number" placeholder="Plan ID" />

        <input id="newReceiverAddress" type="text" placeholder="New Receiver Address (0x...)" />

        <button id="modifyReceiverBtn" class="secondary-btn">
            Update Receiver
        </button>

        <p class="warning-text">
            ‚ö† Only current receiver can modify<br />
            ‚ö† Applies only to future EMI payments
        </p>
    </section>

    <!-- ================= STATUS ================= -->
    <section class="card">
        <h2>Plan Monitoring</h2>
        <p class="muted">
            EMI status updates (activation, payments, completion) will
            appear automatically while this page is open.
        </p>
    </section>

    <!-- ================= FOOTER ================= -->
    <footer class="footer">
        <p>
            üßæ EMI is pull-based & secure.<br />
            üîí No funds are held by this app.
        </p>
    </footer>

    <!-- ================= SCRIPTS ================= -->
    <script>
        function goBack() {
            window.location.href = "./home.html";
        }
    </script>

</body>

</html>