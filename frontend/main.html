<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMI AutoPay - Receiver Panel</title>
    <link rel="stylesheet" href="style.css">

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script src="abi.js"></script>

    <script type="module" src="./receiver.js" defer></script>
</head>

<body>

    <button class="home-btn back-btn" onclick="goBack()">Back</button>
    <h1>Receiver â€“ Create EMI Plan</h1>

    <div id="wallet">
        <button id="connectWalletBtn">Connect Wallet</button>
        <p id="account"></p>
        <p id="network"></p>
    </div>

    <hr>

    <div id="createPlan">
        <h2>Enter EMI Details</h2>

        <!-- Blockchain & Token Dropdowns -->
        <label for="blockchainSelect">Select Blockchain:</label>
        <select id="blockchainSelect"></select>

        <label for="tokenSelect">Select Token:</label>
        <select id="tokenSelect"></select>

        <input id="receiverAddress" placeholder="Receiver Address (0x...)" type="text">
        <input id="emiAmount" placeholder="EMI Amount" type="text">

        <select id="intervalSelect">
            <option value="3600">1 Hour</option>
            <option value="10800">3 Hours</option>
            <option value="21600">6 Hours</option>
            <option value="43200">12 Hours</option>
            <option value="86400">Daily</option>
            <option value="604800">Weekly</option>
            <option value="2592000">Monthly</option>
            <option value="custom">Custom (minutes)</option>
        </select>

        <input id="customInterval" placeholder="Custom minutes" style="display:none">
        <input id="totalAmount" placeholder="Total Amount" type="text">

        <button id="createPlanBtn">Generate QR</button>

        <h3>Share this QR to Sender</h3>
        <div id="qrCode"></div>
    </div>

    <hr>

    <button onclick="window.location.href='wallets.html'">Connected Wallets</button>

    <script>
        function goBack() {
            window.location.href = "./home.html";
        }
    </script>

    <script type="module">
        import { AppConfig } from "./config.js";

        const blockchainSelect = document.getElementById("blockchainSelect");
        const tokenSelect = document.getElementById("tokenSelect");

        // Populate blockchain dropdown
        Object.keys(AppConfig.CHAINS).forEach((key) => {
            const opt = document.createElement("option");
            opt.value = key;
            opt.text = AppConfig.CHAINS[key].name;
            blockchainSelect.appendChild(opt);
        });

        // Pre-select Ethereum
        blockchainSelect.value = "ethereum";

        // Populate token dropdown based on selected blockchain
        function populateTokens() {
            const chainKey = blockchainSelect.value;
            tokenSelect.innerHTML = "";
            const tokens = AppConfig.getTokens(chainKey);

            for (const tokenName in tokens) {
                const opt = document.createElement("option");
                opt.value = tokens[tokenName]; // contract address
                opt.text = tokenName;
                tokenSelect.appendChild(opt);
            }

            // Pre-select USDT
            tokenSelect.value = tokens["USDT"];
        }

        // Initial token population
        populateTokens();

        // Update token dropdown if blockchain changes
        blockchainSelect.addEventListener("change", populateTokens);
    </script>

</body>

</html>