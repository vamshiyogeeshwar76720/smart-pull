<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMI AutoPay - Receiver Panel</title>
    <link rel="stylesheet" href="style.css">

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <!-- <script src="./abi.js"></script> -->

    <script type="module" src="./receiver.js" defer></script>
</head>

<body>

    <button class="home-btn back-btn" onclick="goBack()">Back</button>
    <h1>Receiver â€“ Create EMI Plan</h1>

    <div id="wallet">
        <button id="connectWalletBtn">Connect Wallet</button>
        <!-- Add this button below Connect Wallet -->
        <button id="disconnectWalletBtn" style="display:none;">Disconnect Wallet</button>



        <p id="account"></p>
        <p id="network"></p>
    </div>

    <hr>

    <div id="createPlan">
        <h2>Enter EMI Details</h2>

        <!-- Blockchain Dropdown -->
        <label for="blockchainSelect">Select Blockchain:</label>
        <select id="blockchainSelect"></select>

        <!-- Token Dropdown -->
        <label for="tokenSelect">Select Token:</label>
        <select id="tokenSelect"></select>

        <!-- Auto-populated Token Address -->
        <label for="tokenAddressDisplay">Token Address:</label>
        <input id="tokenAddressDisplay" type="text" disabled placeholder="Token address auto-filled">


        <input id="receiverAddress" placeholder="Receiver Address (0x...)" type="text">

        <!-- Receiver Network Auto-Filled -->
        <label>Receiver Network:</label>
        <input id="receiverNetworkInput" placeholder="Connect wallet to auto-fill" type="text" disabled>

        <input id="emiAmount" placeholder="EMI Amount" type="number">

        <label>Payment Interval:</label>
        <select id="intervalSelect">
            <option value="3600">1 Hour</option>
            <option value="10800">3 Hours</option>
            <option value="21600">6 Hours</option>
            <option value="43200">12 Hours</option>
            <option value="86400">Daily</option>
            <option value="604800">Weekly</option>
            <option value="2592000">Monthly</option>
            <option value="custom">Custom (minutes)</option>
        </select>

        <input id="customInterval" placeholder="Custom minutes" style="display:none">

        <input id="totalAmount" placeholder="Total Amount" type="number">

        <button id="createPlanBtn">Generate QR</button>

        <h3>Share this QR to Sender</h3>
        <div id="qrCode"></div>
    </div>

    <hr>

    <button onclick="window.location.href='wallets.html'">Connected Wallets</button>

    <script>
        function goBack() {
            window.location.href = "./home.html";
        }
    </script>

    <script>
        // Keep receiverNetworkInput updated
        const netInput = document.getElementById("receiverNetworkInput");
        const observer = new MutationObserver(() => {
            const walletNet = document.getElementById("network").innerText;
            if (walletNet.includes("Network:")) {
                netInput.value = walletNet.replace("Network: ", "").split(" ")[0];
            }
        });
        observer.observe(document.getElementById("network"), { childList: true });
    </script>
</body>

</html>